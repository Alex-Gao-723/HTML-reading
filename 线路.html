<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­å›½è‡ªé©¾æ¸¸çº¿è·¯åœ°å›¾</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
        }
        
        #container {
            width: 100%;
            height: 100vh;
            position: relative;
        }
        
        .info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            max-width: 300px;
        }
        
        .info-panel h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
            border-bottom: 2px solid #1890ff;
            padding-bottom: 10px;
        }
        
        .route-list {
            list-style: none;
        }
        
        .route-list li {
            padding: 8px 0;
            color: #666;
            display: flex;
            align-items: center;
            font-size: 14px;
        }
        
        .route-list li:before {
            content: '';
            width: 10px;
            height: 10px;
            background: #1890ff;
            border-radius: 50%;
            margin-right: 10px;
            flex-shrink: 0;
        }
        
        .route-list li.start:before {
            background: #52c41a;
            width: 12px;
            height: 12px;
        }
        
        .route-list li.end:before {
            background: #ff4d4f;
            width: 12px;
            height: 12px;
        }
        
        .distance-info {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e8e8e8;
            font-size: 13px;
            color: #999;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #666;
        }
    </style>
</head>
<body>
    <div id="container">
        <div class="loading">åœ°å›¾åŠ è½½ä¸­...</div>
    </div>
    
    <div class="info-panel">
        <h2>ğŸš— è‡ªé©¾æ¸¸çº¿è·¯</h2>
        <ul class="route-list">
            <li class="start">ğŸ“ æµå— (èµ·ç‚¹)</li>
            <li>ğŸ“ å“ˆå°”æ»¨</li>
            <li>ğŸ“ åŒ—äº¬</li>
            <li>ğŸ“ è¥¿å®‰</li>
            <li class="end">ğŸ“ æˆéƒ½ (ç»ˆç‚¹)</li>
        </ul>
        <div class="distance-info">
            <p>æ€»é‡Œç¨‹ï¼š<span id="totalDistance">è®¡ç®—ä¸­...</span></p>
            <p>é¢„è®¡æ—¶é—´ï¼š<span id="totalTime">è®¡ç®—ä¸­...</span></p>
        </div>
    </div>

    <script src="https://webapi.amap.com/maps?v=2.0&key=19ee4d304edd79346348de24ea04860c"></script>
    <script>
        window._AMapSecurityConfig = {
            securityJsCode: 'code',
        }
        
        // åˆå§‹åŒ–åœ°å›¾
        AMapLoader.load({
            key: "19ee4d304edd79346348de24ea04860c",
            version: "2.0",
            plugins: ['AMap.Driving', 'AMap.Marker', 'AMap.InfoWindow']
        }).then((AMap) => {
            // åˆ›å»ºåœ°å›¾å®ä¾‹
            const map = new AMap.Map('container', {
                zoom: 5,
                center: [108.939821, 34.343147], // ä¸­å›½ä¸­å¿ƒä½ç½®
                mapStyle: 'amap://styles/whitesmoke'
            });

            // å®šä¹‰åŸå¸‚åæ ‡
            const cities = [
                { name: 'æµå—', position: [117.000923, 36.675807] },
                { name: 'å“ˆå°”æ»¨', position: [126.642464, 45.756967] },
                { name: 'åŒ—äº¬', position: [116.405285, 39.904989] },
                { name: 'è¥¿å®‰', position: [108.948024, 34.263161] },
                { name: 'æˆéƒ½', position: [104.065735, 30.659462] }
            ];

            // æ·»åŠ åŸå¸‚æ ‡è®°
            cities.forEach((city, index) => {
                let icon;
                if (index === 0) {
                    // èµ·ç‚¹æ ‡è®°ï¼ˆç»¿è‰²ï¼‰
                    icon = new AMap.Icon({
                        size: new AMap.Size(30, 40),
                        image: 'https://webapi.amap.com/theme/v1.3/markers/n/start.png',
                        imageSize: new AMap.Size(30, 40)
                    });
                } else if (index === cities.length - 1) {
                    // ç»ˆç‚¹æ ‡è®°ï¼ˆçº¢è‰²ï¼‰
                    icon = new AMap.Icon({
                        size: new AMap.Size(30, 40),
                        image: 'https://webapi.amap.com/theme/v1.3/markers/n/end.png',
                        imageSize: new AMap.Size(30, 40)
                    });
                } else {
                    // é€”å¾„ç‚¹æ ‡è®°ï¼ˆè“è‰²ï¼‰
                    icon = new AMap.Icon({
                        size: new AMap.Size(25, 34),
                        image: 'https://webapi.amap.com/theme/v1.3/markers/n/mid.png',
                        imageSize: new AMap.Size(25, 34)
                    });
                }

                const marker = new AMap.Marker({
                    position: city.position,
                    map: map,
                    title: city.name,
                    icon: icon,
                    label: {
                        content: city.name,
                        direction: 'top',
                        style: {
                            fontSize: '14px',
                            fontWeight: 'bold',
                            color: '#333',
                            backgroundColor: 'rgba(255, 255, 255, 0.9)',
                            border: '1px solid #ccc',
                            borderRadius: '4px',
                            padding: '5px 10px'
                        }
                    }
                });
            });

            // åˆ›å»ºé©¾è½¦è·¯çº¿è§„åˆ’
            const driving = new AMap.Driving({
                map: map,
                policy: AMap.DrivingPolicy.LEAST_TIME, // æœ€å¿«æ·è·¯çº¿
                showTraffic: false
            });

            let totalDistance = 0;
            let totalTime = 0;
            let completedRoutes = 0;

            // ç»˜åˆ¶è·¯çº¿
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4'];
            
            for (let i = 0; i < cities.length - 1; i++) {
                const start = new AMap.LngLat(cities[i].position[0], cities[i].position[1]);
                const end = new AMap.LngLat(cities[i + 1].position[0], cities[i + 1].position[1]);
                
                driving.search(start, end, function(status, result) {
                    if (status === 'complete') {
                        completedRoutes++;
                        
                        // è·å–è·¯çº¿æ•°æ®
                        if (result.routes && result.routes.length) {
                            const route = result.routes[0];
                            totalDistance += route.distance;
                            totalTime += route.time;
                            
                            // è‡ªå®šä¹‰è·¯çº¿æ ·å¼
                            const path = [];
                            route.steps.forEach(step => {
                                step.path.forEach(p => {
                                    path.push([p.lng, p.lat]);
                                });
                            });
                            
                            // ç»˜åˆ¶è·¯çº¿
                            new AMap.Polyline({
                                path: path,
                                strokeColor: colors[i % colors.length],
                                strokeOpacity: 0.8,
                                strokeWeight: 6,
                                strokeStyle: "solid",
                                strokeDasharray: [0, 0, 0],
                                lineJoin: 'round',
                                lineCap: 'round',
                                map: map
                            });
                            
                            // å½“æ‰€æœ‰è·¯çº¿éƒ½å®Œæˆæ—¶ï¼Œæ›´æ–°æ€»è·ç¦»å’Œæ—¶é—´
                            if (completedRoutes === cities.length - 1) {
                                document.getElementById('totalDistance').textContent = 
                                    (totalDistance / 1000).toFixed(1) + ' å…¬é‡Œ';
                                document.getElementById('totalTime').textContent = 
                                    Math.floor(totalTime / 3600) + ' å°æ—¶ ' + 
                                    Math.floor((totalTime % 3600) / 60) + ' åˆ†é’Ÿ';
                                
                                // è°ƒæ•´åœ°å›¾è§†é‡ä»¥æ˜¾ç¤ºæ‰€æœ‰æ ‡è®°
                                map.setFitView();
                            }
                        }
                    }
                });
            }

            // ç§»é™¤åŠ è½½æç¤º
            document.querySelector('.loading').style.display = 'none';
            
        }).catch((e) => {
            console.error('åœ°å›¾åŠ è½½å¤±è´¥:', e);
            document.querySelector('.loading').textContent = 'åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
        });
    </script>
</body>
</html>
